<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Greenfiles Image Compressor</title>
  <style>
    :root {
      --bg-color: #b6eeb3;
      --text-color: black;
      --accent: white;
      --border: black;
    }

    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      margin-bottom: 1rem;
    }

    .upload-section {
      border: 2px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      background: var(--accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 600px;
    }

    .thumbnail {
      margin-top: 1rem;
      max-width: 200px;
      border: 2px solid var(--border);
    }

    .slider-section, .format-section {
      margin-top: 2rem;
      width: 100%;
    }

    input[type=range] {
      width: 100%;
    }

    .preview-section {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 600px;
    }

    .preview {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 2px solid var(--border);
      background: var(--accent);
      padding: 1rem;
      border-radius: 1rem;
    }

    .button-pill {
      border: 2px solid var(--border);
      background: var(--accent);
      border-radius: 999px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: bold;
      margin: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Greenfiles Image Compressor</h1>

  <div class="upload-section">
    <input type="file" accept="image/*" id="fileInput" />
    <img class="thumbnail" id="thumbnail" src="" alt="Thumbnail preview (illustrative)" style="display:none" />
  </div>

  <div class="slider-section" id="sliderContainer" style="display:none">
    <label for="quality">Compression Quality: <span id="qualityLabel">80</span>%</label>
    <input type="range" id="quality" min="10" max="100" value="80" />
    <p>Estimated size: <span id="estimatedSize">-</span></p>
  </div>

  <div class="format-section" id="formatContainer" style="display:none">
    <label>Choose Format:</label><br />
    <button class="button-pill" onclick="setFormat('image/jpeg')">JPEG</button>
    <button class="button-pill" onclick="setFormat('image/png')">PNG</button>
    <button class="button-pill" onclick="setFormat('image/webp')">WebP</button>
  </div>

  <div class="preview-section" id="previewSection" style="display:none">
    <div class="preview">
      <h3>Original</h3>
      <img id="originalPreview" style="max-width:100%" />
    </div>
    <div class="preview">
      <h3>Compressed</h3>
      <img id="compressedPreview" style="max-width:100%" />
      <a id="downloadLink" class="button-pill" download="compressed-image.jpg">Download</a>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const thumbnail = document.getElementById('thumbnail');
    const qualitySlider = document.getElementById('quality');
    const qualityLabel = document.getElementById('qualityLabel');
    const estimatedSize = document.getElementById('estimatedSize');
    const sliderContainer = document.getElementById('sliderContainer');
    const formatContainer = document.getElementById('formatContainer');
    const previewSection = document.getElementById('previewSection');
    const originalPreview = document.getElementById('originalPreview');
    const compressedPreview = document.getElementById('compressedPreview');
    const downloadLink = document.getElementById('downloadLink');

    let originalFile;
    let currentFormat = 'image/jpeg';

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      originalFile = file;
      const reader = new FileReader();
      reader.onload = () => {
        thumbnail.src = reader.result;
        thumbnail.style.display = 'block';
        originalPreview.src = reader.result;
        compressImage();
        sliderContainer.style.display = 'block';
        formatContainer.style.display = 'block';
        previewSection.style.display = 'flex';
      };
      reader.readAsDataURL(file);
    });

    qualitySlider.addEventListener('input', () => {
      qualityLabel.textContent = qualitySlider.value;
      compressImage();
    });

    function setFormat(fmt) {
      currentFormat = fmt;
      compressImage();
    }

    function compressImage() {
      const quality = parseInt(qualitySlider.value) / 100;
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0);

          canvas.toBlob(blob => {
            const url = URL.createObjectURL(blob);
            compressedPreview.src = url;
            downloadLink.href = url;
            downloadLink.download = `compressed.${currentFormat.split('/')[1]}`;
            estimatedSize.textContent = `${(blob.size / 1024).toFixed(1)} KB`;
          }, currentFormat, quality);
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(originalFile);
    }
  </script>
</body>
</html>
